Step -1 
-------
------------------------------ Discovery and Recon -----------------------------
================================================================================

<! --- Azure Tenant  !-->
---------------------------------------

• Get if Azure tenant is in use, tenant name and Federation
  https://login.microsoftonline.com/getuserrealm.srf?login=[USERNAME@DOMAIN]&xml=1 #you can use any username like -"nonexistanceuser"

• Get the Tenant ID
  https://login.microsoftonline.com/[DOMAIN]/.well-known/openid-configuration

• Validate Email ID by sending requests to
  https://login.microsoftonline.com/common/GetCredentialType

   #  We can use the AADInternals tool (https://github.com/Gerenios/AADInternals) for Recon.
• It is a PowerShell module that we will use for multiple attacks against AzureAD. 
    - Import-Module C:\AzAD\Tools\AADInternals\AADInternals.psd1 -Verbose


• Get tenant name, authentication, brand name (usually same as directory name) and domain name
    - Get-AADIntLoginInformation -UserName root@defcorphq.onmicrosoft.com
• Get tenant ID
    - Get-AADIntTenantID -Domain defcorphq.onmicrosoft.com
• Get tenant domains
    - Get-AADIntTenantDomains -Domain defcorphq.onmicrosoft.com
    - Get-AADIntTenantDomains -Domain deffin.onmicrosoft.com
    - Get-AADIntTenantDomains -Domain microsoft.com
• Get all the information
    - Invoke-AADIntReconAsOutsider -DomainName defcorphq.onmicrosoft.com

 <!-- Email IDs !>
 --------------------------

• We can use o365creeper-ng to check if an email ID belongs to a tenant.
• It makes requests to the GetCredentialType API that we saw earlier - 
  C:\Python27\python.exe C:\AzAD\Tools\o365creeper-ng\o365creeper-ng.py -f C:\AzAD\Tools\emails.txt -o C:\AzAD\Tools\validemails.txt

 <!-----Azure Services !------>
 ------------------------------
• Azure services are available at specific domains and subdomains.
• We can enumerate if the target organization is using any of the services by looking for such subdomains.
• The tool that we will use for this is MicroBurst (https://github.com/NetSPI/MicroBurst)
• Microburst is a useful tool for security assessment of Azure. It uses Az, AzureAD, AzureRM and MSOL tools and additional REST API calls!
    - Import-Module C:\AzAD\Tools\MicroBurst\MicroBurst.psm1 -Verbose
• Enumerate all subdomains for an organization specified using the '-Base' parameter:
    - Invoke-EnumerateAzureSubDomains -Base defcorphq -Verbose



-------------------------------------------------------------------------------------------------------------------------
    For Lab  :  Please find the credentials of "test@defcorphq.onmicrosoft.com" in the lab portal - enterprisesecurity.io
---------------------------------------------------------------------------------------------------------------------------

A normal user has many interesting permissions in Entra ID!
=========================================================== 

- Read all users, Groups, Applications, Devices, Roles, Subscriptions, and their public properties
- Invite Guests
- Create Security groups
- Read "non-hidden" Group memberships
- Add guests to Owned groups
- Create new application
- Add up to '50' devices to Azure

*********** check for on prem in the "roles and administrator's" filter to check whether it is hybrid AD or not *************

************************* User settings need to check ********************* 

MSGraph API: 
-------------

The Microsoft Graph API is a unified, RESTful web API that serves as the gateway to data and intelligence across Microsoft
cloud services, including Microsoft 365, Windows, and Microsoft Entra ID (formerly Azure AD). It provides a single endpoint
(https://graph.microsoft.com) for developers to build applications that interact with millions of users and their data. 

Use Install-Module Microsoft.Graph to install (needs internet). 
*Already installed on the student VM.*
• Not to be confused with Microsoft Graph CLI :P Attacking

 Note :- 

 Now we need to find out the access token, we will find the graph token. 

 Connect-MgGraph
•
We can also login using an access token


 Step 1 : Login in myaccount.microsoft.com
 Step 2 : Search for organization in network to get the bearar token 
 Step 3 : $GraphToken = eyJ0…
          Connect-MgGraph –AccessToken ($GraphToken | ConvertTo-SecureString -AsPlainText -Force) 
 Step 4 : Run the below commands for information gathering 
 
• Get the current session state : 
    - Get-MgContext
• Get details of the current tenant (Available in Beta version) : 
    - Get-MgOrganization | fl *
• Enumerate all users : 
    - Get-MgUser -All
• Enumerate a specific user : 
    - Get-MgUser -UserIdtest@defcorphq.onmicrosoft.com
• Search for a user based on string in first characters of DisplayName or userPrincipalName (wildcard not supported) : 
    - Get-MgUser -Filter "startsWith(DisplayName, 'a')" -ConsistencyLevel eventual
• Search for users who contain the word "admin" in their Display name: 
    - Get-MgUser -All |?{$_.Displayname -match "admin"}
    - Get-MgUser -Search '"DisplayName:admin"' -ConsistencyLevel eventual
• List all the attributes for a user
    - Get-MgUser -UserIdtest@defcorphq.onmicrosoft.com | fl *
    - Get-MgUser -UserIdtest@defcorphq.onmicrosoft.com | %{$_.PSObject.Properties.Name}
• Search attributes for all users that contain the string "password":
    - Get-MgUser -All |%{$Properties = $_;$Properties.PSObject.Properties.Name | % {if ($Properties.$_ -match 'password') {"$($Properties.UserPrincipalName) - $_ - $($Properties.$_)"}}}
• All users who are synced from on-prem
    - Get-MgUser -All | ?{$_.OnPremisesSecurityIdentifier -ne $null}
• All users who are from Entra ID
    - Get-MgUser -All | ?{$_.OnPremisesSecurityIdentifier -eq $null}
• Objects created by any user (use -ObjectId for a specific user)
    - Get-MgUserCreatedObject -UserId test@defcorphq.onmicrosoft.com | fl *
• Objects owned by a specific user
    - Get-MgUserOwnedObject -UserId test@defcorphq.onmicrosoft.com | fl *
• List all Groups
    - Get-MgGroup -All
• Enumerate a specific group
    - Get-MgGroup -GroupId 783a312d-0de2-4490-92e4-539b0e4ee03e
• Search for a group based on string in first characters of DisplayName (wildcard not supported)
    - Get-MgGroup -ConsistencyLevel eventual -Search '"DisplayName:A"'
• To search for groups which contain the word "admin" in their name:
    - Get-MgGroup -ConsistencyLevel eventual -Search '"DisplayName:Admin"'
• Get Groups that allow Dynamic membership
    - Get-MgGroup | ?{$_.GroupTypes -eq 'DynamicMembership'}
• All groups that are synced from on-prem (note that security groups are not synced)
    - Get-MgGroup -All| ?{$_.OnPremisesSecurityIdentifier -ne $null}
• All groups that are from Entra ID
    - Get-MgGroup -All | ?{$_.OnPremisesSecurityIdentifier -eq $null}
• Get members of a group
    - Get-MgGroupMember -GroupId 783a312d-0de2-4490-92e4-539b0e4ee03e
• Get groups and roles where the specified user is a member
    - (Get-MgUserMemberOf -UserId test@defcorphq.onmicrosoft.com ).AdditionalProperties
• Get all available role templates
    - Get-MgDirectoryRoleTemplate
• Get all enabled roles (a built-in role must be enabled before usage)
    - Get-MgDirectoryRole
• Enumerate users to whom roles are assigned
  $RoleId = (Get-MgDirectoryRole -Filter "DisplayName eq 'Global Administrator'").Id
    -   (Get-MgDirectoryRoleMember -DirectoryRoleId $RoleId).AdditionalProperties
• Get all Azure joined and registered devices
    - Get-MgDevice -All | fl *

• List all the active devices (and not the stale devices)
    - Get-MgDevice -All | ?{$_.ApproximateLastSignInDateTime - ne $null}
 
Enumeration - Mg Module - Devices
==================================
• List devices owned by a user
    - (Get-MgUserOwnedDevice -userId michaelmbarron@defcorphq.onmicrosoft.com).AdditionalProperties
• List devices registered by a user
    - (Get-MgUserRegisteredDevice -userId michaelmbarron@defcorphq.onmicrosoft.com).AdditionalProperties
• List devices managed using Intune
    - Get-MgDevice -All| ?{$_.IsCompliant -eq "True"} | fl *
 
Enumeration Mg Module - Apps
===============================
• Get all the application objects registered with the current tenant (visible in App Registrations in Azure portal). An application object is the global representation of an app.
    - Get-MgApplication -All

• Get all details about an application
    - Get-MgApplicationByAppId -AppId f072c4a6-b440-40de-983f-
a7f3bd317d8f  | fl *

• Get an application based on the display name
    - Get-MgApplication -All | ?{$_.DisplayName -match "app"}

• The Get-MgApplication will show all the applications details including password but password value is not shown. List all the apps with an application password
    - Get-MgApplication -All| ?{$_.PasswordCredentials -ne $null}
 
Enumeration - Mg Module - Apps
================================
• Get owner of an application
    - (Get-MgApplicationOwner -ApplicationId 35589758- 714e-43a9-be9e- 94d22fdd34f6).AdditionalProperties.userPrincipalName

• Get Apps where a User has a role (exact role is not shown) Get-MgUserAppRoleAssignment -UserId roygcain@defcorphq.onmicrosoft.com | fl *

• Get Apps where a Group has a role (exact role is not shown)
    - Get-MgGroupAppRoleAssignment -GroupId 57ada729-a581- 4d6f-9f16-3fe0961ada82 | fl *
 
Enumeration - Mg Module - Service Principals
============================================
• Enumerate Service Principals (visible as Enterprise Applications in Azure Portal). Service principal is local representation for an app in a specific tenant and it is the security object that has privileges. This is the 'service account'!
• Service Principals can be assigned Azure roles.
• Get all service principals
    - Get-MgServicePrincipal -All
• Get all details about a service principal
    - Get-MgServicePrincipal -ServicePrincipalId fd518680-b290-4db2-b92a-5dbd025c6791| fl *
• Get an service principal based on the display name
    - Get-MgServicePrincipal -All | ?{$_.DisplayName -match "app"}
• List all the service principals with an application password
    - Get-MgServicePrincipal -All | ?{$_.KeyCredentials -ne $null}

Enumeration – Mg Module - Service Principals
==========================================
• Get owner of a service principal
    - (Get-MgServicePrincipalOwner -ServicePrincipalId fd518680-b290-4db2- b92a-5dbd025c6791).AdditionalProperties.userPrincipalName
• Get objects owned by a service principal
    - Get-MgServicePrincipalOwnedObject -ServicePrincipalId fd518680-b290-4db2-b92a-5dbd025c6791
• Get objects created by a service principal
    - Get-MgServicePrincipalCreatedObject -ServicePrincipalId fd518680-b290-4db2-b92a-5dbd025c6791

Enumeration – Mg Module - Service Principals
================================================
• Get group and role memberships of a service principal
    - Get-MgServicePrincipalMemberOf -ServicePrincipalId fd518680-b290-4db2-b92a-5dbd025c6791 | fl *

=================================================
** Intall AZ command module - Install-Module Az 
==================================================
• To be able to use PowerShell module, we must connect to Azure first:
    - Connect-AzAccount
• We can also login using an access token for ARM and Graph API
    - Connect-AzAccount -AccessToken $Token MicrosoftGraphAccessToken $GraphToken -AccountId test@defcorphq.onmicrosoft.com
• Az PowerShell can enumerate both Entra ID and Azure Resources.
• All the Entra ID cmdlets have the format *-AzAD*
    - Get-Command *azad*
    - Get-AzADUser
• Cmdlets for other Azure resources have the format *Az*
    - Get-Command *az*
    - Get-AzResource
• Find cmdlets for a particular resource. For example, VMs
    - Get-Command *azvm*
    - Get-Command -Noun *vm* -Verb Get
    - Get-Command *vm*
• Get the information about the current context (Account, Tenant, Subscription etc.)
    - Get-AzContext
• List all available contexts
    - Get-AzContext -ListAvailable
• Enumerate subscriptions accessible by the current user
    - Get-AzSubscription
• Enumerate all resources visible to the current user
    - Get-AzResource
• Enumerate all Azure RBAC role assignments
    - Get-AzRoleAssignment

=========================================
Enumeration - Az PowerShell - AAD Users
=========================================
• Enumerate all users
    - Get-AzADUser
• Enumerate a specific user
    - Get-AzADUser -UserPrincipalName test@defcorphq.onmicrosoft.com
• Search for a user based on string in first characters of DisplayName (wildcard not supported)
    - Get-AzADUser -SearchString "admin"
• Search for users who contain the word "admin" in their Display name:
    - Get-AzADUser |?{$_.Displayname -match "admin"}
• List all groups
    - Get-AzADGroup
• Enumerate a specific group
    - Get-AzADGroup -ObjectId 783a312d-0de2-4490-92e4-539b0e4ee03e
• Search for a group based on string in first characters of DisplayName (wildcard not supported)
    - Get-AzADGroup -SearchString "admin" | fl *
• To search for groups which contain the word "admin" in their name:
    - Get-AzADGroup |?{$_.Displayname -match "admin"}
• Get members of a group
    - Get-AzADGroupMember -ObjectId 783a312d-0de2-4490-92e4-539b0e4ee03e
========================================
Enumeration - Az PowerShell - AAD Apps
========================================

• Get all the application objects registered with the current tenant (visible in App Registrations in Azure portal). An application object is the global representation of an app.
    - Get-AzADApplication
• Get all details about an application
    - Get-AzADApplication -ObjectId a1333e88-1278-41bf-8145-155a069ebed0
• Get an application based on the display name
    - Get-AzADApplication | ?{$_.DisplayName -match "app"}
• The Get-AzADAppCredential will show the applications with an application password but password value is not shown. 
  List all the apps with an application password
    - Get-AzADApplication | %{if(Get-AzADAppCredential -ObjectID $_.ID){$_}}

====================================================
Enumeration - Az PowerShell - AAD Service Principals
====================================================

• Enumerate Service Principals (visible as Enterprise Applications in Azure Portal). Service principal is local representation for an app in a specific tenant and it is the security object that has privileges. This is the 'service account'!
• Service Principals can be assigned Azure roles.
• Get all service principals
    - Get-AzADServicePrincipal
• Get all details about a service principal
    - Get-AzADServicePrincipal -ObjectId cdddd16e-2611-4442-8f45-053e7c37a264
• Get a service principal based on the display name
    - Get-AzADServicePrincipal | ?{$_.DisplayName -match "app"}

=================================
Enumeration - Azure CLI (az cli)
=================================
• To be able to use az cli, we must connect to Entra ID first (opens up a login page using Default browser):
    - az login
• You can configure az cli to set some default behaviour (output type, location, resource group etc.)
    - az configure
• We can format output using the --output parameter. The default format is JSON. You can change the default as discussed previously.
• List all the users in Entra ID and format output in table
    - az ad user list --output table
• List only the userPrincipalName and givenName (case sensitive) for all the users in Entra ID and format output in table. Az cli uses JMESPath (pronounced 'James path') query.
    - az ad user list --query "[].[userPrincipalName,displayName]" --output table
• List only the userPrincipalName and givenName (case sensitive) for all the users in Entra ID, rename the properties and format output in table
    - az ad user list --query "[].{UPN:userPrincipalName, Name:displayName}" --output table
• We can use JMESPath query on the results of JSON output. Add --query-examples at the end of any command to see examples
    - az ad user show list --query-examples
• We will discuss additional options of az cli as and when required!
•
Get details of the current tenant (uses the account extension)
az account tenant list
•
Get details of the current subscription (uses the account extension)
az account subscription list
•
List the current signed-in user
az ad signed-in-user show
Enumeration - Azure CLI - AAD Users
•
Enumerate all users
az ad user list
az ad user list --query "[].[displayName]" -o table
•
Enumerate a specific user (lists all attributes)
az ad user show --id test@defcorphq.onmicrosoft.com
•
Search for users who contain the word "admin" in their Display name (case sensitive):
az ad user list --query "[?contains(displayName,'admin')].displayName"
•
When using PowerShell, search for users who contain the word "admin" in their Display name. This is NOT case-sensitive:
az ad user list | ConvertFrom-Json | %{$_.displayName -match "admin"}
Enumeration - Azure CLI - AAD Users
•
All users who are synced from on-prem
az ad user list --query "[?onPremisesSecurityIdentifier!=null].displayName"
•
All users who are from Entra ID
az ad user list --query "[?onPremisesSecurityIdentifier==null].displayName"
====================================
Enumeration - Azure CLI - AAD Groups
====================================
•
List all Groups
az ad group list
az ad group list --query "[].[displayName]" -o table
•
Enumerate a specific group using display name or object id
az ad group show -g "VM Admins"
az ad group show -g 783a312d-0de2-4490-92e4-539b0e4ee03e
•
Search for groups that contain the word "admin" in their Display name (case sensitive) - run from cmd:
az ad group list --query "[?contains(displayName,'admin')].displayName"
•
When using PowerShell, search for groups that contain the word "admin" in their Display name. This is NOT case-sensitive:
az ad group list | ConvertFrom-Json | %{$_.displayName -match "admin"}
Enumeration - Azure CLI - AAD Groups
•
All groups that are synced from on-prem
az ad group list --query "[?onPremisesSecurityIdentifier!=null].displayName"
•
All groups that are from Entra ID
az ad group list --query "[?onPremisesSecurityIdentifier==null].displayName"
====================================
Enumeration - Azure CLI - AAD Groups
====================================
•
Get members of a group
az ad group member list -g "VM Admins" --query "[].[displayName]" -o table
•
Check if a user is member of the specified group
az ad group member check --group "VM Admins" --member-id b71d21f6-8e09-4a9d-932a-cb73df519787
•
Get the object IDs of the groups of which the specified group is a member
az ad group get-member-groups -g "VM Admins"
===================================
Enumeration - Azure CLI - AAD Apps
===================================
•
Get all the application objects registered with the current tenant (visible in App Registrations in Azure portal). An application object is the global representation of an app.
az ad app list
az ad app list --query "[].[displayName]" -o table
•
Get all details about an application using identifier uri, application id or object id
az ad app show --id a1333e88-1278-41bf-8145-155a069ebed0
•
Get an application based on the display name (Run from cmd)
az ad app list --query "[?contains(displayName,'app')].displayName"
•
When using PowerShell, search for apps that contain the word "slack" in their Display name. This is NOT case-sensitive:
az ad app list | ConvertFrom-Json | %{$_.displayName -match "app"}
==================================
Enumeration - Azure CLI - AAD Apps
==================================
•
Get owner of an application
az ad app owner list --id a1333e88-1278-41bf-8145-155a069ebed0 --query "[].[displayName]" -o table
•
List apps that have password credentials
az ad app list --query "[?passwordCredentials != null].displayName"
•
List apps that have key credentials (use of certificate authentication)
az ad app list --query "[?keyCredentials != null].displayName"
================================================
Enumeration - Azure CLI - AAD Service Principals
================================================
•
Enumerate Service Principals (visible as Enterprise Applications in Azure Portal). Service principal is local representation for an app in a specific tenant and it is the security object that has privileges. This is the 'service account'!
•
Service Principals can be assigned Azure roles.
•
Get all service principals
az ad sp list --all
az ad sp list --all --query "[].[displayName]" -o table
•
Get all details about a service principal using service principal id or object id
az ad sp show --id cdddd16e-2611-4442-8f45-053e7c37a264
•
Get a service principal based on the display name
az ad sp list --all --query "[?contains(displayName,'app')].displayName"
•
When using PowerShell, search for service principals that contain the word "slack" in their Display name. This is NOT case-sensitive:
az ad sp list --all | ConvertFrom-Json | %{$_.displayName -match "app"}
=================================================
Enumeration - Azure CLI - AAD Service Principals
=================================================
•
Get owner of a service principal
az ad sp owner list --id cdddd16e-2611-4442-8f45-053e7c37a264 --query "[].[displayName]" -o table
•
Get service principals owned by the current user
az ad sp list --show-mine
•
List apps that have password credentials
az ad sp list --all --query "[?passwordCredentials != null].displayName"
•
List apps that have key credentials (use of certificate authentication)
az ad sp list -all --query "[?keyCredentials != null].displayName"

=========================================
Entra ID - Microsoft Identity Platform
=========================================

• Microsoft Identity Platform provides the identity service for cloud applications.
• It uses OpenID Connect (OIDC) and OAuth 2.0 compliant authentication service.
• Entra ID makes use of the platform for authenticating identities.


<!----- Missing slides data ----- >>>>>>>>>>>>>>>


==================
Stealing Tokens
=================
•
Usually, tokens contain all the claims (including that for MFA and Conditional Access etc.) so they are useful in bypassing such security controls.
•
As we will see later in the course, there are multiple ways of stealing or requesting tokens :
-  Illicit Consent Grant
-  Attacker-in-the-middle
-  Managed identity
-  Extract from Office and other applications memory
-  Network interception
-  Valid credentials for an identity

================================================
Requesting Tokens with CLI tools - Az PowerShell
================================================
• If you are already connected to a tenant, request an access token for resource manager (ARM)
    - $SecureARMToken = (Get-AzAccessToken-ResourceUrlhttps://management.azure.com -AsSecureString).Token
• Decrypt the token to analyze
    - $TokenPtr = [System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($SecureARMToken)
    - $ARMToken = [System.Runtime.InteropServices.Marshal]::PtrToStringAuto($TokenPtr)
• Request an access token for Microsoft Graph to access Entra ID.
    - Get-AzAccessToken -AsSecureString -ResourceTypeName MSGraph
• From older versions of Az PowerShell, get a token for Microsoft Graph
    - (Get-AzAccessToken -AsSecureString -ResourceUrl "https://graph.microsoft.com").Token

============================
Stealing Tokens from az cli
============================
• az cli (before 2.30.0 – January 2022) stores access tokens in clear text in accessTokens.json in the directory C:\Users\[username]\.Azure
                                                                            -------------------------- > this one is interesting ------     
• Newer versions store tokens in msal_token_cache.bin in the .Azure directory and protected using DPAPI.
• We can read tokens from the file, use them and request new ones too!
• azureProfile.json in the same directory contains information about subscriptions.
• You can modify accessTokens.json to use access tokens with az cli but better to use with Az PowerShell module.
• To clear the access tokens, always use az logout

==============================
Using Tokens with APIs - ARM
==============================
• Get an access token and use it with ARM API. For example, list all the subscriptions

- $Token = 'eyJ0eXAi..'
- $URI = 'https://management.azure.com/subscriptions?api-version=2020-01-01'
- $RequestParams = @{
                    Method = 'GET'
                    Uri = $URI
                Headers = @{
                            'Authorization' = "Bearer $Token"       
                            }
                    }
- (Invoke-RestMethod @RequestParams).value

===========================
Using Tokens with APIs - Mg
============================
• Get an access token for MS Graph. For example, list all the users

$Token = 'eyJ0eXAi..'
$URI = 'https://graph.microsoft.com/v1.0/users'
$RequestParams = @{
Method = 'GET'
Uri = $URI
Headers = @{
'Authorization' = "Bearer $Token"
}
}
(Invoke-RestMethod @RequestParams).value

==================================
Continuous Access Evaluation (CAE)
==================================
• CAE can help in invalidating access tokens before their expiry time (default 1 hour).
• Useful in cases like 
- User termination or password change enforced in near real time
- Blocks use of access token outside trusted locations when location based conditional access is present
• In CAE sessions, the access token lifetime is increased up to 28 hours.

=======================
Enumeration - ROADTools
=======================

• RoadRecon (https://github.com/dirkjanm/ROADtools) is a tool for enumerating Entra ID environments!
• RoadRecon uses a different version '1.61-internal' of AADGraph API that provides more information.
• Enumeration using RoadRecon includes three steps
    - Authentication
    - Data Gathering
    - Data Exploration
• Roadrecon is already setup on your student VM.
• roadrecon supports username/password, access and refresh tokens, device code flow (sign-in from another device) and PRT cookie.
    - cd C:\AzAD\Tools\ROADTools
    - .\venv\Scripts\activate
    - roadrecon auth --device-code
• Once authentication is done, use the below command to gather data (ignore the errors)
    - roadrecon gather
• Use roadrecon GUI to analyse the gathered information (starts a web server on port 5000)
    - roadrecon gui

==========================
Enumeration - Monkey365
===========================
• A PowerShell based tool to "easily conduct" M365, Azure and Entra ID configuration review.
• 200+ checks.
• Needs Reader on subscriptions, Global Reader in Entra ID and Sharepoint Administrator for Sharepoint.
• MFA compatible authentication supported.
• Can export in CSV, JSON, CLIXML and a beautiful HTML report.

=====================
Enumeration - Maester
=====================
• A PowerShell based tool that is "Your Microsoft Security test automation framework!".
• Includes Entra ID Security Config Analyzer, CISA, CIS and own tests.
• Easy to use interactive HTML report.
• Provides one-click remediation.
• Can be used for continuous monitoring.
• Registers "Microsoft Graph PowerShell" application in Entra ID that needs admin consent (high privilege permissions) - not used in the lab.

========================
Enumeration - BloodHound
========================
• BloodHound's AzureHound supports Azure and Entra ID too to map attack paths!
• It uses Graph and ARM API for gathering the data through its collector.
• You can have Read-only access to a pre-populated BloodHound CE UI -https://azurehound-altsecdashboard.msappproxy.net/
    Use the credentials for cartpreader@altsecdashboard.onmicrosoft.com from the lab portal - enterprisesecurity.io
• BloodHound Legacy is now deprecated.

• Run the collector to gather data
    $passwd = ConvertTo-SecureString "SuperVeryEasytoGuessPassword@1234" -AsPlainText -Force
    $creds = New-Object System.Management.Automation.PSCredential ("test@defcorphq.onmicrosoft.com", $passwd)
    Connect-AzAccount -Credential $creds
    Connect-AzureAD -Credential $creds
    C:\AzAD\Tools\AzureHound\AzureHound.ps1
    Invoke-AzureHound -Verbose
•In the lab, the data in pre-populated BloodHound CE was collected Reader role on subscription!